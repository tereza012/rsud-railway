import{r as t,j as e,B as L,u as O,q as M,a as P}from"./app-BmJ9-8ba.js";import{u as V,D as H,a as K,b as Z,c as J,d as q,e as G,P as Q,f as W,g as X,h as Y,i as ee,j as se,k as te,l as ae}from"./index-B8jzc5xN.js";import{z as B,L as R,I as ne}from"./input-CwNdd4mS.js";import{S as le,a as re,b as oe,c as ce,d as ie,e as de}from"./select-mkzc42j4.js";const fe=B.object({content:B.instanceof(File).superRefine((a,i)=>{a.size>2*1024*1024&&i.addIssue({code:B.ZodIssueCode.custom,message:"Ukuran file tidak boleh lebih dari 2MB"}),a.name===""&&i.addIssue({code:B.ZodIssueCode.custom,message:"File tidak boleh kosong"})}),type:B.string().min(1)}),$=({name:a,callback:i,className:h,value:s,file_type:o,getErr:d,acceptFile:N="application/pdf"})=>{var U;const[f,p]=t.useState((s==null?void 0:s.content)??new File([],"")),[m,x]=t.useState((s==null?void 0:s.type)??""),[w,g]=t.useState(((U=s==null?void 0:s.content)==null?void 0:U.name)??""),[D,b]=t.useState((s==null?void 0:s.fake_url)??null),[k,r]=t.useState(!1),[l,y]=t.useState(null);t.useEffect(()=>{s!=null&&s.content&&(p(s.content),x(s.type),g(s.content.name),u(s.content,s.type))},[s]),t.useEffect(()=>{s!=null&&s.content&&(p(s.content),x(s.type),g(s.content.name),i&&i(a,{content:s.content,type:s.type,fake_url:s.fake_url}),u(s.content,s.type))},[]),t.useEffect(()=>{s!=null&&s.content&&(p(s.content),x(s.type),g(s.content.name),i&&i(a,{content:s.content,type:s.type,fake_url:s.fake_url}),u(f,m))},[f,m]);const E=c=>{if(c.target.files.length===0)return;const j=c.target.files[0];p(j),u(j,m),b(URL.createObjectURL(j)),i&&i(a,{content:j,type:m,fake_url:URL.createObjectURL(j)})},u=(c,j)=>{try{fe.parse({content:c,type:j}),d(l===null)}catch(_){_ instanceof B.ZodError&&(y(_),d(l===null))}},F=c=>{x(c),u(f,c),i&&i(a,{content:f,type:c,fake_url:URL.createObjectURL(f)})},I=c=>{f&&r(c)};return e.jsx("div",{className:"flex flex-col gap-1 w-full",children:e.jsxs("div",{className:"flex gap-1 w-full max-md:flex-col",children:[e.jsxs(R,{className:"w-full",children:[e.jsxs("div",{className:"flex justify-start align-middle w-full",children:[e.jsx("p",{className:"truncate max-w-[75%]",children:w===""?"Dokumen":w}),w!==""&&e.jsx("span",{className:"text-sm fill-slate-400",onMouseOver:k?void 0:()=>I(!0),onMouseOut:k?void 0:()=>I(!1),onClick:()=>I(!k),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})})})]}),e.jsx(ne,{type:"file",name:a,id:a,className:h,"aria-label":w,placeholder:w,accept:N,onChange:E}),l&&e.jsx("span",{className:"text-sm text-red-500",children:l.issues.map(c=>c.path.includes("content")?c.message:null)})]}),e.jsxs(R,{className:"max-md:w-full w-1/3",children:["Tipe Dokumen",e.jsxs(le,{name:`${a}_type`,onValueChange:F,value:m,children:[e.jsx(re,{className:"w-full mt-1",children:e.jsx(oe,{placeholder:"Pilih Dokumen"})}),e.jsx(ce,{children:e.jsx(ie,{children:o.map(c=>e.jsx(de,{value:c,children:c.toUpperCase()},c+Date.now()%Math.random()))})})]}),l&&e.jsx("span",{className:"text-sm text-red-500",children:l.issues.map(c=>c.path.includes("type")?c.message:null)})]}),D&&e.jsx(H,{open:k,onOpenChange:I,children:e.jsxs(K,{className:"z-[999999999999999999999999]",children:[e.jsxs(Z,{children:[e.jsxs(J,{children:["Tampilan Awal Dokumen"," ",o[0].toUpperCase()]}),e.jsxs(q,{children:["Ini merupakan halaman pertama (1) dari dokumen yang telah dibuat.",e.jsx("br",{}),e.jsx("b",{children:f.name})]})]}),e.jsx("div",{className:"w-full flex justify-center max-h-[52vh] overflow-scroll",children:e.jsx(G,{file:D,className:"mt-2 h-full w-full",children:e.jsx(Q,{pageNumber:1,renderTextLayer:!1,renderAnnotationLayer:!1,className:"h-full overflow-hidden rounded shadow-slate-300 shadow-xl"})})})]})})]})})},me=({content:a,handler:i,file_type:h,getErr:s,name:o,isRepeater:d=!0,acceptFile:N})=>{const[f,p]=t.useState((a==null?void 0:a.length)>0?a==null?void 0:a.map(r=>({name:o,value:r})):[{name:o,value:{content:new File([],""),type:""}}]),[,m]=t.useState(0),x=t.useMemo(()=>f,[f]),w=V("(min-width: 768px)");t.useEffect(()=>{a.length>0&&p(a.map(r=>({name:o,value:r}))),m(r=>r+1)},[a]),t.useEffect(()=>{a.length>0&&p(a.map(r=>({name:o,value:r}))),m(r=>r+1)},[]);const g=(r,l)=>{p([...f,{name:r,value:l}])},D=r=>{p(f.filter((l,y)=>y!==r))},b=(r,l)=>{const y=r.split("[")[1].replace("]",""),E=f.map((u,F)=>F===parseInt(y)?{...u,value:l}:u);p(E),i&&i(E.map(u=>u.value))},k=r=>{s(r)};return d?e.jsx("div",{className:"flex gap-2 justify-center align-middle mt-2",children:e.jsx("div",{className:"flex flex-col gap-1 w-full align-bottom",children:f.map((r,l)=>e.jsxs("div",{className:"flex gap-2 w-full max-md:flex-col",children:[e.jsx($,{name:`${o}[${l}]`,acceptFile:N,callback:b,className:"w-full mt-1",value:r.value,file_type:h,getErr:k}),e.jsxs("div",{className:`flex ${w?"flex-col":"gap-2"} h-full ${l>0?"justify-end":"justify-between"}`,children:[e.jsx(L,{type:"button",className:`w-fit ${l>0?"max-md:w-1/3":"max-md:w-full"} justify-center text-center font-normal bg-blue-500 fill-white mt-4`,onClick:()=>g(`${o}`,{content:new File([],""),type:""}),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M19 11h-6V5h-2v6H5v2h6v6h2v-6h6z"})})}),l>0&&e.jsx(L,{type:"button",className:`w-fit ${l>0?"max-md:w-1/3":"max-md:w-full"} justify-center text-center font-normal bg-red-500 fill-white mt-4`,onClick:()=>D(l),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M5 11h14v2H5z"})})})]})]},JSON.stringify(x[l])+l))})}):e.jsx("div",{className:"flex gap-2 justify-center align-middle mt-2",children:e.jsx("div",{className:"flex flex-col gap-1 w-full align-bottom",children:f.map((r,l)=>e.jsx("div",{className:"flex gap-2 w-full max-md:flex-col",children:e.jsx($,{name:`${o}[${l}]`,acceptFile:N,callback:b,className:"w-full mt-1",value:r.value,file_type:h,getErr:k})},JSON.stringify(x[l])+l))})})},S=me,pe=({obtainSk:a})=>{const[i,h]=t.useState([]),s=t.useCallback(d=>{h(d),a(d)},[]),o=d=>{console.error("Error: ",d)};return e.jsx("div",{className:"flex flex-col gap-2 w-full",children:e.jsxs("div",{className:"w-full",children:[e.jsx("span",{className:"font-semibold",children:"SK"}),e.jsx(S,{name:"sk-file",handler:s,file_type:["sk"],getErr:o,content:i})]})})},he=({obtainBankAccount:a,obtainNpwp:i})=>{const[h,s]=t.useState([]),[o,d]=t.useState([]),N=t.useCallback(m=>{s(m),a(m)},[]),f=t.useCallback(m=>{d(m),i(m)},[]),p=m=>{console.error("Error: ",m)};return e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("span",{className:"font-semibold",children:"Rekening Bank"}),e.jsx(S,{name:"bank-account",handler:N,file_type:["rekening"],getErr:p,content:h})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("span",{className:"font-semibold",children:"NPWP"}),e.jsx(S,{name:"npwp",handler:f,file_type:["npwp"],getErr:p,content:o})]})]})},ue=({obtainSk:a})=>{const[i,h]=t.useState([]),s=t.useCallback(d=>{h(d),a(d)},[]),o=d=>{console.error("Error: ",d)};return e.jsx("div",{className:"flex flex-col gap-2 w-full",children:e.jsxs("div",{className:"w-full",children:[e.jsx("span",{className:"font-semibold",children:"SK"}),e.jsx(S,{name:"sk-file",handler:s,file_type:["sk"],getErr:o,content:i})]})})};function ke({dialogClose:a,isOpen:i}){const{toast:h}=O(),s=M().props,{role:o}=s.user;let d="";o==="controller"&&(d="Pengendali Pelatihan"),o==="user"&&(d="Pelatihan");const[N,f]=t.useState(i),[p,m]=t.useState([]),[x,w]=t.useState([]),[g,D]=t.useState([]),[b,k]=t.useState([]),[r,l]=t.useState([]),[y,E]=t.useState([]),u=t.useCallback(n=>{m(n)},[]),F=t.useCallback(n=>{k(n)},[]),I=t.useCallback(n=>{w(n)},[]),U=t.useCallback(n=>{D(n)},[]),c=n=>{console.error("Error: ",n)},j=n=>{n&&(f(n),a(n),window.location.reload())},_=t.useCallback(n=>{l(n)},[]),T=t.useCallback(n=>{E(n)},[]);t.useEffect(()=>{},[]);const A=async()=>{let n=[...p,...x];switch(o){case"facilitator":n=[...n,...r],n=[...n,...y];break;case"controller":n=[...n,...b,...g];break;case"organizer":n=[...n,...b,...g];break;default:n=[...n,...g];break}console.log(n);const z=new FormData;n.forEach((C,v)=>{z.append(`files[${v}]`,C.content),z.append(`file_type[${v}]`,C.type)});try{const v=(await P.post("/api/user/docs",z,{headers:{"Content-Type":"multipart/form-data"}})).data;v.success?h({title:"Dokumen gagal dikirim",description:v.message,duration:5e3}):h({title:"Dokumen berhasil dikirim",description:v.message,duration:5e3}),j(!0)}catch(C){C.response?console.log("Error posting data:",C.response.data):console.log("Error:",C.message)}};return e.jsx(W,{open:N,onOpenChange:j,children:e.jsxs(X,{className:"max-w-[95vw] max-h-[95vh] overflow-hidden rounded",children:[e.jsxs(Y,{children:[e.jsx(ee,{children:"Dokumen"}),e.jsx(se,{children:"Lengkapi dokumen berikut:"})]}),e.jsxs("div",{className:"flex flex-col items-center space-x-2 gap-2 h-[70vh] px-2 overflow-y-scroll overflow-x-hidden",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("span",{className:"font-semibold",children:"CV"}),e.jsx(S,{name:"cv-file",handler:u,file_type:["cv"],getErr:c,isRepeater:!1,content:p})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("span",{className:"font-semibold",children:"Ijazah"}),e.jsx(S,{name:"diploma-file",handler:I,file_type:["ijazah"],getErr:c,content:x})]}),o!=="facilitator"&&e.jsxs("div",{className:"w-full",children:[e.jsxs("span",{className:"font-semibold",children:["Sertifikat ",d]}),e.jsx(S,{name:"certificate-file",handler:U,file_type:["sertifikat"],getErr:c,content:g})]}),o==="organizer"&&e.jsx(ue,{obtainSk:F}),o==="facilitator"&&e.jsx(he,{obtainBankAccount:_,obtainNpwp:T}),o==="controller"&&e.jsx(pe,{obtainSk:F})]}),e.jsxs(te,{className:"mb-5 gap-2",children:[e.jsx(L,{type:"button",variant:"default",className:"w-1/2 max-md:w-full",onClick:A,children:"Kirim"}),e.jsx(ae,{asChild:!0,children:e.jsx(L,{type:"button",variant:"destructive",className:"w-1/2 max-md:w-full",children:"Close"})})]})]})})}export{ke as U};
